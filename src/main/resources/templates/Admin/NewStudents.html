<html xmlns:th="http://www.thymeleaf.org" th:replace="~{Admin/Adminbase::layout(~{::main})}">
<body>
<main>
<div class="row">
  <div class="col-sm-12">
    <div class="card-header bg-primary">
      <h4 class="text-center text-white m-0">Manage New Student</h4>
    </div>
    
    
<!-- Filter Input -->
<div class="row m-3">
    <div class="col-md-4">
        <input type="text" id="filterEnrollment" class="form-control" placeholder="Filter by Enrollment No">
    </div>
</div>


    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-striped">
          <thead class="table-dark">
            <tr>
              <th>Sr. No.</th>
              <th>Enrollment No.</th>
              <th>Name</th>
              <th>F'Name</th>
              <th>M'Name</th>
              <th>Gender</th>
              <th>Contact No.</th>
              <th>Email</th>
              <th>Reg Date</th>
              <th>Course</th>
              <th>Branch</th>
              <th>Year</th>
              <th>Payment Receipt</th>
              <th>UTR No.</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr th:each="student, stat : ${newStudent}">
              <td th:text="${stat.index + 1}">1</td>
              <td th:text="${student.rollNo}">Enrollment No.</td>
              <td th:text="${student.name}">Name</td>
              <td th:text="${student.fatherName == null ? 'No Records' : student.fatherName}">F'Name</td>
              <td th:text="${student.motherName == null ? 'No Records' : student.motherName}">M'Name</td>
              <td th:text="${student.gender == null ? 'No Records' : student.gender}">Gender</td>
              <td th:text="${student.contactNo}">Contact No.</td>
              <td th:text="${student.email}">Email</td>
              <td th:text="${#temporals.format(student.regDate, 'dd-MM-yyyy HH:mm')}">Reg Date</td>
              <td th:text="${student.program}">Course</td>
              <td th:text="${student.branch}">Branch</td>
              <td th:text="${student.year}">Year</td>
              <td>
                <a th:if="${student.paymentImage != null}" 
   th:href="@{/Admin/ViewPayment(id=${student.id})}" 
   class="btn btn-sm btn-success">
   View Payment
</a>



                <span th:if="${student.paymentImage == null}">N/A</span>
              </td>
              <td th:text="${student.utrNo == null ? 'N/A' : student.utrNo}">UTR No.</td>
              <td>
                <!-- SweetAlert style button -->
                <a href="#" 
                   class="btn btn-warning btn-sm approve-btn" 
                   th:data-url="@{ApproveStudent(id=${student.id})}">
                   Pending
                </a>
              </td>
            </tr>
            <tr th:if="${newStudent.isEmpty()}">
              <td colspan="15" class="text-center">No Students Found.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
 <input type="hidden" id="serverMessage" th:value="${mgs}">
 
 
 
<script>
document.addEventListener('DOMContentLoaded', function () {
    const filterInput = document.getElementById('filterEnrollment');
    const tableBody = document.querySelector('table tbody');

    filterInput.addEventListener('input', function () {
        const value = this.value.toLowerCase();
        tableBody.querySelectorAll('tr').forEach(row => {
            const enrollment = row.children[1]?.textContent.toLowerCase() || '';
            row.style.display = enrollment.includes(value) ? '' : 'none';
        });
    });
});
</script>

<!-- SweetAlert2 Library -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const approveButtons = document.querySelectorAll('.approve-btn');

  approveButtons.forEach(button => {
    button.addEventListener('click', function (e) {
      e.preventDefault();
      const approveUrl = this.getAttribute('data-url');

      Swal.fire({
        title: 'Approve Student?',
        text: "Do you really want to approve this student?",
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#28a745',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Yes, approve',
        cancelButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) {
          window.location.href = approveUrl;
        }
      });
    });
  });
});


document.addEventListener("DOMContentLoaded", function () {
    const serverMessage = document.getElementById("serverMessage")?.value;

    if (serverMessage && serverMessage.trim() !== "") {
        const lowerMsg = serverMessage.toLowerCase();
        const isError = lowerMsg.includes('error') || lowerMsg.includes('invalid');

        Swal.fire({
            title: isError ? 'Error' : 'Success',
            text: serverMessage,
            icon: isError ? 'error' : 'success',
            confirmButtonColor: '#2575fc',
            timer: 4000,
            timerProgressBar: true
        });
    }
});

</script>
</main>
</body>
</html>
