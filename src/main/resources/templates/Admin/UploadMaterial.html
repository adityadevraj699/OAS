<html th:replace="~{Admin/Adminbase::layout(~{::main})}">
<body>
<main>
    <div class="row">
        <div class="col-sm-9 mx-auto">
            <div class="card shadow-lg">
                <div class="card-header bg-primary">
                    <h4 class="text-center text-white m-0">Upload Study Material and Assignments</h4>
                </div>
                <div class="card-body">
                    <form  th:object="${material}" method="post" enctype="multipart/form-data">
                        <div class="mb-3">
                            <label class="form-label">Subject</label>
                            <input type="text" th:field="*{subject}" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Program</label>
                            <input type="text" th:field="*{program}" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Branch</label>
                            <input type="text" th:field="*{branch}" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Year</label>
                            <input type="text" th:field="*{year}" class="form-control" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Material Type</label>
                            <select th:field="*{materialType}" class="form-select" required>
                                <option value="">-- Select Type --</option>
                                <option value="Study_Material">Study Material</option>
                                <option value="Assignment">Assignment</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Upload File</label>
                            <input type="file" name="file" class="form-control" accept=".jpg,.png,.jpeg,.pdf,.doc,.docx,.ppt,.pptx" required>
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-success">Upload</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- SweetAlert -->
    <input type="hidden" id="serverMessage" th:value="${mgs}"/>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const serverMessage = document.getElementById("serverMessage")?.value;
            if (serverMessage && serverMessage.trim() !== "") {
                const lowerMsg = serverMessage.toLowerCase();
                const isError = lowerMsg.includes('failed') || lowerMsg.includes('invalid') || lowerMsg.includes('disabled') || lowerMsg.includes('not found');
                Swal.fire({
                    title: 'Notification',
                    text: serverMessage,
                    icon: isError ? 'error' : 'success',
                    confirmButtonColor: '#2575fc',
                    background: '#f9f9f9',
                    color: '#333',
                    timer: 4000,
                    timerProgressBar: true
                });
            }
        });
    </script>

    <!-- Inline file viewer -->
    <div th:if="${material.fileUrl != null}" class="mt-3">
        <div th:if="${#strings.endsWith(material.fileUrl,'jpg') or #strings.endsWith(material.fileUrl,'png') or #strings.endsWith(material.fileUrl,'jpeg') or #strings.endsWith(material.fileUrl,'gif')}">
            <img th:src="${material.fileUrl}" class="img-fluid"/>
        </div>
        <div th:if="${#strings.endsWith(material.fileUrl,'mp4') or #strings.endsWith(material.fileUrl,'mov')}">
            <video th:src="${material.fileUrl}" controls width="100%"></video>
        </div>
        <div th:if="${#strings.endsWith(material.fileUrl,'pdf') or #strings.endsWith(material.fileUrl,'docx') or #strings.endsWith(material.fileUrl,'pptx')}">
            <iframe th:src="'https://docs.google.com/gview?url=' + ${material.fileUrl} + '&embedded=true'" width="100%" height="600px"></iframe>
        </div>
    </div>
</main>
</body>
</html>
